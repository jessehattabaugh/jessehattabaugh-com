<extends src="base.html">
	<block name="title">
		Success
	</block>
	<block name="head">
		<style>
			.share-item {
				border: 1px inset;
				margin: 1em 0;
				padding: 1em;
			}
			gravatar-wc img {
				border-radius: 50%;
				vertical-align: middle;
			}
			share-list ol {
				padding: 0;
				margin: 0;
				list-style: none;
			}
		</style>
	</block>
	<block name="main">
		<h2>Thanks for Sharing!</h2>
		<share-list></share-list>
		<script src="https://unpkg.com/gravatar-wc/dist/gravatar-wc.js"></script>
		<script type="module">
			import {
				html,
				component,
				useState,
				useEffect,
			} from 'https://cdn.pika.dev/haunted';
			import { format } from 'https://cdn.pika.dev/timeago.js/^4.0.2';

			customElements.define(
				'share-list',
				component(ShareList, { useShadowDOM: false }),
			);

			function ShareList() {
				const [items, setItems] = useState([]);

				useEffect(async () => {
					const res = await fetch('.netlify/functions/shares');
					const data = await res.json();
					setItems(data);
					console.log('âš¡', data);
				}, []);

				return html`
					<ol>
						${items.map(
							(item) =>
								html`
									<li class="share-item">
										<article>
											<h3>
												<a
													href="${item.data.url}"
													target="_blank"
													>${item.data.title}</a
												>
											</h3>
											<h4>
												${format(
													item.created_at,
													'en-us',
												)}
											</h4>
											<p>${item.text}</p>
											<cite>
												<gravatar-wc
													default="monsterid"
													email="${item.data.email}"
													size="32"
												></gravatar-wc>
												${item.data.name}
											</cite>
										</article>
									</li>
								`,
						)}
					</ol>
				`;
			}
		</script>
	</block>
</extends>
